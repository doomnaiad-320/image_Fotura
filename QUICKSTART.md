# 🚀 对话式 AI 工作台 - 快速启动指南

## ✅ 当前状态

**阶段 1 UI 基础已完成！** 你现在可以立即测试对话式工作台了。

---

## 🎯 立即体验

### 方式 1: 访问新页面 (推荐)

1. **启动开发服务器**
```bash
npm run dev
```

2. **访问对话式工作台**
```
http://localhost:3000/studio-v2
```

3. **开始使用**
   - 选择一个模型
   - 输入提示词，例如："一只赛博朋克风格的猫"
   - 点击发送或按 ⌘+Enter
   - 生成后点击"作为输入"进行二次编辑

### 方式 2: 从经典工作台切换

1. 访问 `http://localhost:3000/studio`
2. 点击右上角的橙色按钮 **"体验对话式工作台"**

---

## 🎨 主要功能

### ✅ 已实现
- ✨ **对话式消息流** - 类似 ChatGPT 的气泡界面
- ✨ **编辑链可视化** - 水平时间轴展示编辑历程
- ✨ **完整 Prompt 累积** - 自动拼接所有编辑步骤
- ✨ **作为输入** - 一键基于上图继续编辑
- ✨ **自适应输入框** - 高度随内容变化
- ✨ **高级选项** - 折叠面板选择比例/尺寸
- ✨ **生成动画** - 脉冲加载效果
- ✨ **错误处理** - 友好的错误提示

### 🔄 待完成 (阶段 2-3)
- 发布到首页 (点击后提示功能未实现)
- 时间轴节点点击回退
- 对话持久化 (刷新会丢失)
- 移动端优化

---

## 📖 使用示例

### 场景 1: 基础文生图

1. 选择模型: `DALL·E-HD`
2. 输入: `一只猫坐在窗台上`
3. 点击发送
4. 等待生成完成

### 场景 2: 链式编辑

```
1. 文生图: "一只猫"
   → [生成图A]

2. 点击"作为输入"
   → 输入: "赛博朋克风格"
   → [生成图B]
   → 编辑链: 原图 → 赛博风格

3. 再次点击"作为输入"
   → 输入: "背景改为东京街景"
   → [生成图C]
   → 编辑链: 原图 → 赛博风格 → 东京背景
   → 完整提示词: "一只猫, 赛博朋克风格, 背景改为东京街景"
```

### 场景 3: 查看编辑链

生成的图片下方会显示：
- 🎨 编辑链时间轴 (可点击节点查看提示词)
- 📝 完整提示词预览
- 🎬 三个操作按钮

---

## 🐛 已知问题

### 正常行为
1. **刷新后对话丢失** - IndexedDB 持久化将在阶段 2 实现
2. **发布按钮点击后只是标记** - 后端 API 将在阶段 3 实现
3. **时间轴节点点击无反应** - 回退功能将在阶段 2 实现

### 需要注意
1. **必须选择模型** - 不选择模型无法发送
2. **生成中无法发送** - 等待当前生成完成
3. **blob URL 限制** - 图片存储在 IndexedDB,发布需要远程 URL

---

## 🔧 调试技巧

### 查看控制台日志

打开浏览器开发者工具 (F12)，查看：
- `[ConversationView]` - 主容器日志
- `[Timeline]` - 时间轴点击日志
- `[History]` - IndexedDB 存储日志

### 测试 API 调用

```javascript
// 在浏览器控制台测试
fetch('/api/ai/images/generations', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    model: 'your-model-slug',
    prompt: '一只猫',
    size: '1024x1024',
    n: 1
  })
}).then(r => r.json()).then(console.log)
```

### 清空 IndexedDB

```javascript
// 在浏览器控制台执行
indexedDB.deleteDatabase('aigc-studio-history')
location.reload()
```

---

## 📂 文件结构

```
components/ai/conversation/
├── conversation-view.tsx          ✅ 主容器 (完成)
├── conversation-header.tsx        ✅ 顶部工具栏 (完成)
├── message-list.tsx               ✅ 消息列表 (完成)
├── message-item.tsx               ✅ 单条消息 (完成)
├── message-actions.tsx            ✅ 操作按钮 (完成)
├── edit-chain-timeline.tsx        ✅ 编辑链时间轴 (完成)
└── input-area.tsx                 ✅ 输入区域 (完成)

app/(web)/
├── studio/page.tsx                ✅ 经典工作台 (已更新)
└── studio-v2/page.tsx             ✅ 对话式工作台 (新增)

lib/ai/
└── prompt-chain.ts                ✅ Prompt链逻辑 (完成)

types/
└── conversation.ts                ✅ 类型定义 (完成)
```

---

## 🎯 下一步计划

### 阶段 2: 持久化与交互 (2-3天)
1. **IndexedDB 对话存储**
   - 扩展现有 `lib/storage/indexeddb.ts`
   - 保存完整对话历史
   - 刷新后恢复会话

2. **时间轴节点回退**
   - 点击节点回到该状态
   - 重新生成该节点及后续

3. **会话管理**
   - 侧边栏显示历史会话
   - 切换/重命名/删除会话

### 阶段 3: 发布与优化 (1-2天)
1. **发布 API**
   - 创建 `app/api/assets/publish/route.ts`
   - 完整 Prompt 写入 Asset 表

2. **发布对话框**
   - 显示完整提示词
   - 可编辑标签和描述

3. **移动端适配**
   - 触摸友好尺寸
   - 滑动手势优化

---

## 📞 获取帮助

### 参考文档
- **实施指南**: `CONVERSATION_IMPLEMENTATION_GUIDE.md`
- **进度跟踪**: `PROGRESS.md`
- **项目文档**: `WARP.md`

### 常见问题

**Q: 为什么我看不到对话式工作台？**
A: 确保访问 `/studio-v2` 而不是 `/studio`

**Q: 生成失败怎么办？**
A: 检查：
1. 是否已选择模型
2. 是否已登录
3. 豆余额是否充足
4. 控制台是否有错误日志

**Q: 如何切换回经典版本？**
A: 点击右上角 "返回经典版本" 或直接访问 `/studio`

**Q: Mock 模式如何开启？**
A: 在 `.env.local` 中设置 `MOCK_AI=1`

---

## 🎉 恭喜！

你已经成功搭建了对话式 AI 工作台的基础框架！

现在可以：
- ✅ 体验对话式生成流程
- ✅ 测试编辑链累积
- ✅ 查看时间轴可视化
- ✅ 使用"作为输入"链式编辑

接下来我们将实现持久化和发布功能，让系统更加完善。

**开始探索吧！** 🚀

---

**最后更新**: 2025-01-14 22:00 UTC
